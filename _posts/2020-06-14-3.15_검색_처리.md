---
title: 3.15 검색 처리
categories: TIL
tags: [spring, jsp,pagination]
---







검색 기능은 검색 조건과 키워드로 나누어 생각해 볼 수 있다.

검색 조건은 일반적으로 select 태그를 이용하거나 checkbox를 이용하는 경우가 많다.

과거에는 checkbox를 이용하는 경우가 더 많았지만, 최근에는 일반 사용자들의 경우에는 select를 관리자용이나 검색 기능이 강한 경우 checkbox를 이용하는 형태가 대부분



#### 검색 기능과 SQL

**검색 기능의 분류**

* 단일 항목 검색
* 다중 항목 검색



오라클은 페이지 처리에 인라인뷰를 이용한다.

따라서 검색 조건에 대한 처리는 인라인뷰의 내부에서 이루어져야 한다.



#### MyBatis의 동적 SQL

MyBatis는 동적 태그 기능을 통해 SQL을 파라미터들의 조건에 맞게 조정할 수 있는 기능을 제공한다.

따라서 전될되는 파라미터를 가공에서 경우에 따라 다른 SQL을 만들어서 실행할 수 있다.



**MyBatis의 동적 태그들**

* if
  * test 속성과 함께 특정한 조건이 true가 되었을 때 포함된 SQL을 사용
* choose (when, otherwise)
  * 여러상황들 중 하나의 상황에서만 동작
* trim where, set
  * if, choose를 내포하여 SQL들을 연결해주고, 앞 뒤에 필요한 구문들(AND, OR, WHERE 등) 을 추가하거나 생략하는 역할
  * TRIM은 prefix, suffix, prefixOverrides, suffixOverrides 속성을 지정할 수 있다.
* foreach
  * List, 배열, 맵 등을 이용해서 루프를 처리할 수 있다. 주로 IN 조건에서 많이 사용하지만, 경우에 따라 복잡한 WHERE 조건을 만들 때에도 사용할 수 있다.



**sql, include 태그와 검색 데이터의 개수 처리**

동적 SQL을이용해서 검색 조건을 처리하는 부분은 해당 데이터의 개수를 처리하는 부분에서도 동일하게 적용되어야만 한다.

이 때 Myatis는 sql이라는 태그를 이용해서 SQL의 일부를 별도로 보관하고, 필요한 경우 include시키는 형태로 사용할 수 있다.

```xml
<sql id="abc">보관할 SQL 문</sql>
<include refid="abc"></include>
```



#### 화면에서 검색 조건 처리

**주의 사항**

* 페이지 번호가 파라미터로 유지되었던 것처럼 **검색 조건과 키워드 역시 항상 화면 이동 시 같이 전송**
* 화면에서 검색 버튼을 클릭하면 새로 검색을 한다는 의미이므로 1페이지로 이동
* 한글의 경우 GET 방식으로 이동하는 경우 문제가 생길 수 있다.



**검색 처리 후 몇가지 문제**

* 3페이지를 보다가 검색을 하면 3페이지로 이동하는 문제
* 검색 후 페이지를 이동하면 검색 조건이 사라지는 문제
* 검색 후 화면세어는 어떤 검색 조건과 키워드를 이용했는지 알 수 없는 문제



**검색 버튼의 이벤트 처리**

검색 버튼을 클릭하면 검색은 1페이지를 하도록 수정

화면에 검색 조건과 키워드가 보이게 처리



**UriComponentsBuilder를 이용하는 링크 생성**

UriComponentsBuilder는 springframework web의 유틸 클래스로 여러 개의 파라미터들을 연결해서 URL 형태로 만들어주는 기능

URL을 만들어주면 리다이렉트를 하거나, form 태그를 사용하는 상황을 많이 줄여줄 수 있다.