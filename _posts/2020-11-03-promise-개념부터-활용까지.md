---
title: promise ê°œë…ë¶€í„° í™œìš©ê¹Œì§€
categories: [JavaScript]
tags:  [promise]
---

promiseëŠ” ë¬´ì—‡ì¸ì§€, ì½œë°±ì„ ëŒ€ì²´í•´ì„œ ì–´ë–»ê²Œ ê¹”ë”í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë³´ì

## Promise

promiseëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì œê³µí•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¡œ ë¹„ë™ê¸°ë¥¼ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.



#### state

stateëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ì˜ ì§„í–‰ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ë©° ì„¸ ê°€ì§€ ìƒíƒœê°€ ìˆë‹¤.

* pending: ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì€ ìƒíƒœ
* fulfilled: ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì–´ ê²°ê³¼ ê°’ì„ ë°˜í™˜í•´ì¤€ ìƒíƒœ
* rejected: ë¹„ë™ê¸° ì²˜ë¦¬ì— ì‹¤íŒ¨í•˜ê±°ë‚˜ ì²˜ë¦¬ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•œ ìƒíƒœ



#### producer

`new <T>(executor: (resolve: (value?: T | PromiseLike<T>) => void, reject: (reason?: any) => void) => void): Promise<T>;`

producerëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ ì‹œ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê³  ì™„ë£Œëì„ ë•Œ resolveì™€ reject ì½œë°± í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤.

producerê°€ ìƒì„±ëœ ìˆœê°„ excutorê°€ ìë™ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.



**resolve: ** ê°’ ë˜ëŠ” ë‹¤ë¥¸ promiseì˜ ê²°ê³¼ë¡œ promiseë¥¼ í•´ê²°í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì½œë°±

**reject:**  ì œê³µëœ ì´ìœ  ë˜ëŠ” ì˜¤ë¥˜ì™€ í•¨ê»˜ promiseë¥¼ ê±°ë¶€í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì½œë°±



```javascript
const promise = new Promise((resolve, reject) =>  {
  // doing some heavy work like  network, read files ...
  console.log('doing something...');
  setTimeout(() => {
    resolve('yghee');
    // reject(new Error('no network'));
  }, 2000);
});
```



#### consumer

consumerì€ promiseê°€ resolveë‚˜ rejectëì„ ë•Œ then, catch, finallyë¡œ ì²˜ë¦¬í•œë‹¤.



**then**

`then<TResult1 = T, TResult2 = never>(onfulfilled?: ((value: T) => TResult1 | PromiseLike<TResult1>) | undefined | null, onrejected?: ((reason: any) => TResult2 | PromiseLike<TResult2>) | undefined | null): Promise<TResult1 | TResult2>;`

promiseì—ì„œ ë°˜í™˜í•œ resolveë‚˜ rejectì˜ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ì½œë°±ì„ ì²¨ë¶€í•œë‹¤.

**onfulfilled:**  promiseê°€ resolveëì„ ë•Œ ì‹¤í–‰í•˜ëŠ” ì½œë°±

**onrejected:**  promiseê°€ rejectëì„ ë•Œ ì‹¤í–‰í•˜ëŠ” ì½œë°±



**catch**

`catch<TResult = never>(onrejected?: ((reason: any) => TResult | PromiseLike<TResult>) | undefined | null): Promise<T | TResult>;`

promiseê°€ rejectëì„ ë•Œë§Œ ì‚¬ìš©í•˜ëŠ” ì½œë°±



**finally**

ìƒˆë¡œ ì¶”ê°€ëœ ì²˜ë¦¬ ë°©ë²•ìœ¼ë¡œ promiseì˜ ì„±ê³µ ì‹¤íŒ¨ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ ì‚¬ìš©í•˜ëŠ” ì½œë°±



```javascript
promise
  .then((value) => {
  console.log(value);
  })
  .catch(error => {
    console.log(error);
  })
  .finally(() => {
    console.log('finally');
  });
```



#### promise chaining

promiseëŠ” ì—¬ëŸ¬ ê°œì˜ promiseë¥¼ ì—°ê²°í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

``` javascript
const fetchNumber = new Promise((resolve, reject) => {
  setTimeout(() => resolve(1), 1000);
});

fetchNumber
  .then(num => num * 2) // 2
  .then(num => num * 3) // 6
  .then(num => {
    return new Promise((resolve, reject) => {
      setTimeout(() => resolve(num - 1), 1000);
    }); 
  })
  .then(num => console.log(num)); // 5
```



#### error handling

promise chainingì„ í•  ë•Œ ì¤‘ê°„ì— rejectê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

rejectê°€ ë°œìƒ ì‹œ catchë¥¼ í†µí•´ ì—ëŸ¬ì— ëŒ€í•œ ëŒ€ì‘ì„ í•˜ì.

```javascript
const getHen = () =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve('ğŸ“'), 1000);
  });
const getEgg = hen =>
  new Promise((resolve, reject) => {
    setTimeout(() => reject(new Error(`${hen} => ğŸ¥š`)), 1000);
  });
const cook = egg =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${egg} => ğŸ³`), 1000);
});

getHen()
  .then(getEgg)
  .catch(error => {
    return 'ğŸ¥–';
  })
  .then(cook)
  .then(console.log)
  .catch(console.log);
```



#### callback to promise

**callbackìœ¼ë¡œë§Œ êµ¬í˜„í•œ ì½”ë“œ**

```javascript
class UserStorage {
  loginUser(id, password, onSuccess, onError) {
    setTimeout(() => {
      if(
        (id === 'yghee' && password === 'dream') ||
        (id === 'coder' && password === 'academy')
      ) {
        onSuccess(id);
      } else {
        onError(new Error('not found'));
      }
    }, 2000);

  }

  getRoles(user, onSuccess, onError) {
    setTimeout(() => {
      if(user === 'yghee') {
        onSuccess({name: 'yghee', role: 'admin'});
      }else {
        onError(new Error('no access'));
      }
    }, 1000);
  }
}

const userStorage = new UserStorage();
const id = prompt('enter your id');
const password = prompt('enter your password');
userStorage.loginUser(
  id, 
  password, 
  (user) => {
    userStorage.getRoles(
      user, 
      (userWithRole) => {
        alert(`Hello ${userWithRole.name}, you have a ${userWithRole.role} role`);
      },
      (error) => {
        console.log(error);
      }
    );
  }, 
  (error) => {
    console.log(error);
  })
```

**promiseë¡œ refactoringí•œ ì½”ë“œ**

```javascript
class UserStorage {
  loginUser(id, password) {
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        if(
          (id === 'yghee' && password === 'dream') ||
          (id === 'coder' && password === 'academy')
        ) {
          resolve(id);
        } else {
          reject(new Error('not found'));
        }
      }, 2000);
    });
  }

  getRoles(user) {
    return new Promise((resolve, reject) => {
    setTimeout(() => {
      if(user === 'yghee') {
        resolve({name: 'yghee', role: 'admin'});
      }else {
        reject(new Error('no access'));
      }
    }, 1000);
    });
  }
}

const userStorage = new UserStorage();
const id = prompt('enter your id');
const password = prompt('enter your password');

userStorage.loginUser(id, password)
  .then(userStorage.getRoles)
  .then(user => 
    alert(
      `Hello ${user.name}, you have a ${user.role} role`
      ))
  .catch(console.log);
```



**callbackì„ parameterë¡œ ë°›ì§€ ì•Šì•„ë„ ë˜ë©°  consumer ë¶€ë¶„ì˜ ê°€ë…ì„±ì´ ë§¤ìš° ë†’ì•„ì§„ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.**